<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BeyondDEX — Affiliate Program</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Page-specific light styles that complement css/style.css -->
  <style>
    :root {
      --bdx-border: #e5e7eb;
      --bdx-muted: #334155;
    }
    /* keep space for fixed header from style.css */
    main { padding: 120px 20px 60px; max-width: 1100px; margin: 0 auto; }

    .affiliate-hero { display: grid; gap: 20px; margin-bottom: 24px; }
    .affiliate-hero h1 { font-size: 2.2rem; line-height: 1.2; }
    .affiliate-hero p { color: #333; font-size: 1.05rem; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

    .card { border: 1px solid var(--bdx-border); }
    .card h2 { font-size: 1.4rem; margin-bottom: 8px; }

    form .field { display: flex; flex-direction: column; gap: 6px; }
    form .field label { font-size: 0.9rem; color: #111; font-weight: 600; }
    form .input, form select, form textarea { border: 1px solid #e0e0e0; border-radius: 10px; padding: 10px 12px; font-size: 0.95rem; background: #fff; color: #111; }
    form textarea { resize: vertical; min-height: 110px; }
    form .checkbox { display: flex; gap: 10px; align-items: start; font-size: 0.9rem; color: #222; }
    form .checkbox input { margin-top: 3px; }

    .error { display: none; margin-top: 10px; border: 1px solid #fecaca; background: #fee2e2; color: #991b1b; padding: 10px 12px; border-radius: 8px; font-size: 0.9rem; }
    .success { display: none; text-align: center; }
    .success .badge { display: inline-flex; align-items: center; justify-content: center; width: 56px; height: 56px; border-radius: 999px; background: #ecfdf5; border: 1px solid #a7f3d0; }

    .subtle { color: #475569; font-size: 0.95rem; }

    .btn-primary { background: #111; color: #fff; border: none; padding: 12px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; }
    .btn-primary:hover { background: #333; }
    .btn-ghost { border: 1px solid var(--bdx-border); padding: 10px 14px; border-radius: 10px; text-decoration: none; color: #111; display: inline-flex; }

    footer { margin-top: 40px; }

    @media (max-width: 1024px) {
      main { padding: 110px 16px 50px; }
      .grid-2 { grid-template-columns: 1fr; }
    }
    @media (max-width: 640px) {
      .affiliate-hero h1 { font-size: 1.9rem; }
      .affiliate-hero p { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <!-- Header cloned from your existing index.html for a perfect match -->
  <header>
    <div class="logo-container">
      <a href="/"><img src="assets/bdx.png" alt="BeyondDEX Logo"></a>
    </div>
    <div class="nav-links">
      <a href="/index.html">Home</a>
      <a href="/dashboard.html">Dashboard</a>
    </div>
    <div class="user-container">
      <div class="user-circle" id="userCircle">?</div>
      <div class="dropdown" id="dropdownMenu">
        <a href="#" id="logout">Log Out</a>
      </div>
    </div>
  </header>

  <main>
    <section class="affiliate-hero">
      <h1>BeyondDEX Affiliate Program</h1>
      <p class="subtle">Earn recurring revenue by sharing BeyondDEX. Apply in minutes — we’ll review your application within <strong>24 hours</strong>.</p>
    </section>

    <div class="grid-2">
      <section class="card">
        <h2>Program perks</h2>
        <ul style="margin-top: 8px; color: #333; line-height: 1.6;">
          <li>• 30% recurring revenue share while referrals remain subscribed</li>
          <li>• Custom tracking links & dashboard (on approval)</li>
          <li>• Prompt payouts and partner support</li>
        </ul>
        <div style="margin-top: 16px; padding: 12px; border: 1px solid var(--bdx-border); border-radius: 12px; background: #fff; color:#475569; font-size: 0.95rem;">
          By applying, you agree to our <a href="#" style="text-decoration: underline; color:#111;">Affiliate Terms</a> and <a href="#" style="text-decoration: underline; color:#111;">Privacy Policy</a>.
        </div>
      </section>

      <section id="formCard" class="card">
        <h2>Apply now</h2>
        <form id="affiliateForm" style="margin-top: 8px;">
          <div class="grid-2" style="gap: 16px;">
            <div class="field"><label for="fullName">Full name</label><input class="input" id="fullName" name="fullName" required autocomplete="name"></div>
            <div class="field"><label for="email">Email</label><input class="input" id="email" name="email" type="email" required autocomplete="email"></div>
            <div class="field"><label for="brand">Brand/Company</label><input class="input" id="brand" name="brand"></div>
            <div class="field"><label for="website">Website / Platform URL</label><input class="input" id="website" name="website" placeholder="https://" required></div>
            <div class="field"><label for="audience">Primary audience</label>
              <select id="audience" name="audience" required>
                <option value="">Select</option>
                <option value="defi">DeFi / Crypto traders</option>
                <option value="nft">NFT / Web3 communities</option>
                <option value="devs">Web3 developers</option>
                <option value="fintech">General fintech</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="field"><label for="audienceSize">Audience size</label>
              <select id="audienceSize" name="audienceSize" required>
                <option value="">Select</option>
                <option value="<1k">Under 1,000</option>
                <option value="1k-10k">1,000 – 10,000</option>
                <option value="10k-100k">10,000 – 100,000</option>
                <option value=">100k">100,000+</option>
              </select>
            </div>
            <div class="field" style="grid-column: 1 / -1;"><label for="promoPlan">How will you promote BeyondDEX?</label><textarea id="promoPlan" name="promoPlan" placeholder="Briefly describe your channels and approach…" required></textarea></div>
            <div class="field" style="grid-column: 1 / -1;"><label for="socials">Social links</label><textarea id="socials" name="socials" placeholder="Twitter, YouTube, TikTok, Discord…"></textarea></div>
            <div class="field"><label for="referral">Referral code (optional)</label><input class="input" id="referral" name="referral"></div>
            <label class="checkbox" style="grid-column: 1 / -1;"><input type="checkbox" id="agree" name="agree"> <span>I agree to the Affiliate Terms and confirm the information provided is accurate.</span></label>
          </div>
          <div id="formError" class="error"></div>
          <button type="submit" id="submitBtn" class="btn-primary" style="margin-top: 14px; width: 100%;">Apply to Program</button>
          <p class="subtle" style="text-align:center; margin-top: 8px;">We’ll get back to you within <strong>24 hours</strong>.</p>
        </form>
      </section>

      <section id="successCard" class="card success" style="grid-column: 1 / -1;">
        <div class="badge">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <h2 style="margin-top: 12px; font-size: 1.6rem;">Thanks! Your application is in.</h2>
        <p class="subtle" style="margin-top: 6px;">We’ll review your details and get back to you within the next 24 hours for approval. Keep an eye on your inbox.</p>
        <a href="/index.html" class="btn-ghost" style="margin-top: 14px;">← Back to home</a>
      </section>
    </div>
  </main>

  <footer>
    &copy; <span id="year"></span> BeyondDEX. All rights reserved.
  </footer>

  <script>
    // --- Firebase (same as index.html) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBbz_G9FNjS4cl0oi1221C3ZOACyZzEgK8",
      authDomain: "beyonddex-be653.firebaseapp.com",
      projectId: "beyonddex-be653",
      storageBucket: "beyonddex-be653.firebasestorage.app",
      messagingSenderId: "687411546401",
      appId: "1:687411546401:web:ec71401e52751d3e121660",
      measurementId: "G-6SH111LB7J"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Header auth UI (same behavior as index)
    const userCircle = document.getElementById("userCircle");
    const dropdownMenu = document.getElementById("dropdownMenu");

    auth.onAuthStateChanged(async user => {
      if (user) {
        const doc = await db.collection("users").doc(user.uid).get();
        const username = doc.exists ? doc.data().username : "U";
        const initial = String(username || 'U').charAt(0).toUpperCase();
        userCircle.textContent = initial;
        dropdownMenu.innerHTML = `<a href="#" id="logout">Log Out</a>`;
        document.getElementById("logout").addEventListener("click", () => { auth.signOut().then(() => location.reload()); });
      } else {
        userCircle.textContent = "+";
        dropdownMenu.innerHTML = `<a href="#" id="login">Log In</a>`;
        document.getElementById("login").addEventListener("click", () => { window.location.href = "/auth.html"; });
      }
    });

    userCircle.addEventListener("click", () => {
      dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
    });
    window.addEventListener("click", e => {
      if (!userCircle.contains(e.target) && !dropdownMenu.contains(e.target)) {
        dropdownMenu.style.display = "none";
      }
    });

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Prefill referral from ?ref=
    (function prefillReferral(){
      const params = new URLSearchParams(location.search);
      const ref = params.get('ref');
      if (ref) document.getElementById('referral').value = ref;
    })();

    // --- Form handling ---
    const form = document.getElementById('affiliateForm');
    const errorEl = document.getElementById('formError');
    const successCard = document.getElementById('successCard');
    const formCard = document.getElementById('formCard');
    const submitBtn = document.getElementById('submitBtn');

    function showError(msg){ errorEl.textContent = msg; errorEl.style.display = 'block'; }
    function clearError(){ errorEl.textContent = ''; errorEl.style.display = 'none'; }

    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
    function validUrl(v){ return /^https?:\/\//i.test(v || ''); }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearError();

      const data = {
        fullName: document.getElementById('fullName').value.trim(),
        email: document.getElementById('email').value.trim(),
        brand: document.getElementById('brand').value.trim(),
        website: document.getElementById('website').value.trim(),
        audience: document.getElementById('audience').value,
        audienceSize: document.getElementById('audienceSize').value,
        promoPlan: document.getElementById('promoPlan').value.trim(),
        socials: document.getElementById('socials').value.trim(),
        referral: document.getElementById('referral').value.trim(),
        agree: document.getElementById('agree').checked,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        status: 'pending'
      };

      // Basic validation
      if(!data.fullName) return showError('Please enter your full name.');
      if(!validEmail(data.email)) return showError('Please enter a valid email address.');
      if(!validUrl(data.website)) return showError('Website/Platform URL must start with http:// or https://');
      if(!data.audience) return showError('Please select your primary audience.');
      if(!data.audienceSize) return showError('Please select your audience size.');
      if(!data.promoPlan) return showError('Tell us briefly how you plan to promote BeyondDEX.');
      if(!data.agree) return showError('You must agree to the terms to continue.');

      // Submit
      submitBtn.disabled = true; submitBtn.textContent = 'Submitting…';
      try {
        // Write to Firestore (affiliate_applications)
        await db.collection('affiliate_applications').add(data);

        // Success UI
        formCard.style.display = 'none';
        successCard.style.display = 'block';
      } catch (err) {
        console.error(err);
        showError('Something went wrong. Please try again.');
      } finally {
        submitBtn.disabled = false; submitBtn.textContent = 'Apply to Program';
      }
    });
  </script>
</body>
</html>